<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>登录注册改密cookie实现</title>
		<script src="cookieBox.js"></script>
	</head>
	<body>
		账号:<input type="text" value="" id="txt1"/><br />
		密码:<input type="password" value="" id="txt2" /><br />
		<input type="button" value="登录" id="btn"/>
		<input type="button" value="注册" id="btn1"/>
		<input type="button" value="修改密码" id="btn2"/>
		<script>
			var txt1=document.getElementById("txt1");
			var txt2=document.getElementById("txt2");
			var btn=document.getElementById("btn");
			var btn1=document.getElementById("btn1");
			var btn2=document.getElementById("btn2");
			
			btn.onclick=function(){
				var result=loginCheck(txt1.value,txt2.value);
				switch(result){
					case 1:
						alert("登录成功!");
						break;
					case 0:
						alert("密码不正确!");
						break;
					case -1:
						alert("你输入的用户名不存在!");
						break;
				}
			}
			
			btn1.onclick=function(){
				var result=register(txt1.value,txt2.value);
				switch(result){
					case 1:
						alert("注册成功!");
						break;
					case -1:
						alert("用户名已被注册!");
						break;
				}
			}
			
			btn2.onclick=function(){
				var newPassword=window.prompt("请输入新密码!");
				var result=modify(txt1.value,txt2.value,newPassword);
				switch(result){
					case 1:
						alert("密码修改成功!");
						break;
					case 0:
						alert("你的密码不正确!");
						break;
					case -1:
						alert("你输入的用户名不存在!");
						break;
				}
			}
			
			
			//登录函数封装
			function loginCheck(name,password){
				var getPassword;
				var strCookie=cookieObj.getCookie("loginBox");
				if(strCookie){
					var arrCookie=strCookie.split("||");
					for(var i=0;i<arrCookie.length;i++){
						var arrItem=arrCookie[i].split("&&");
						if(arrItem[0]==name&&arrItem[1]==password){
							return 1;
						}
						else if(arrItem[0]==name){
							return 0;
						}
					}
					return -1;
				}else{
					return -1;
				}
			}
			
			//注册函数封装
			function register(name,password){
				if(loginCheck(name,password)==-1){
					var oldCookie=cookieObj.getCookie("loginBox");
					var newCookie;
					if(oldCookie){
						newCookie=oldCookie+"||"+name+"&&"+password;
					}
					else{
						newCookie=name+"&&"+password;
					}
					cookieObj.setCookie("loginBox",newCookie,30);
					return 1;
				}
				else{
					return -1;
				}
				
			}
			
			//修改函数封装
			function modify(name,oldPassword,newPassword){
				var temp=0;
				if(loginCheck(name,oldPassword)==1){
					var strCookie=cookieObj.getCookie("loginBox");
					var arrCookie=strCookie.split("||");
					for(var i=0;i<arrCookie.length;i++){
						var arrItem=arrCookie[i].split("&&");
						if(arrItem[0]==name&&arrItem[1]==oldPassword){
							arrCookie[i]=name+"&&"+newPassword;
							temp=1;
						}
					}
					var newCookie=arrCookie.join("||");
					cookieObj.setCookie("loginBox",newCookie,30);
				}
				else if(loginCheck(name,oldPassword)==0){
					temp=0;
				}
				else{
					temp=-1;
				}
				return temp;
			}
			
			
			
			
			
			
			
			
			
		</script>
	</body>
</html>
