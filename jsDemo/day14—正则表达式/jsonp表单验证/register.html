<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>注册</title>
		<style>
			.box{width: 600px;height: 200px;background:#eee;margin: 0 auto;padding-left: 30px;}
			input{margin-top: 20px;margin-left: 30px;}
			#register{margin-left: 120px;}
			span{font-size: 10px;padding-left: 10px;}
		</style>
	</head>
	<body>
		<div class="box">
			请输入用户名:<input type="text" id="name"/><span id="nameCheck"></span><span id="nameCheck2"></span><br />
			请输入密码&nbsp;:<input type="password" id="pwd"/><span id="pwdCheck"></span><br />
			请确认密码&nbsp;:<input type="password" id="repwd" /><span id="repwdCheck"></span><br />
			<input type="button" value="立即注册" id="register" />
		</div>
		
		<script>
			var oName=document.getElementById("name");
			var nameCheck=document.getElementById("nameCheck");
			var nameCheck2=document.getElementById("nameCheck2");
			var regName=new RegExp("^([a-z]|[A-Z])([a-z]|[A-Z]|[0-9])*$");
			var pwd=document.getElementById("pwd");
			var pwdCheck=document.getElementById("pwdCheck");
			var regPwd=new RegExp("^.{6,}$");
			var repwd=document.getElementById("repwd");
			var repwdCheck=document.getElementById("repwdCheck");
			var register=document.getElementById("register");
			
			
			oName.onkeydown=function(){
				var result=regName.test(oName.value.trim());
				if(result){
					nameCheck.innerHTML="用户名格式正确";
					nameCheck.style.color="green";
				}else{
					nameCheck.innerHTML="用户名格式不正确";
					nameCheck.style.color="red";
				}
			}
			pwd.onblur=function(){
				if(pwd.value.trim()==""){
					pwdCheck.innerHTML="密码不能为空!";
					pwdCheck.style.color="red";
				}
				else{
					var result=regPwd.test(pwd.value.trim());
					if(result){
						pwdCheck.innerHTML="密码可用!";
						pwdCheck.style.color="green";
					}
					else{
						pwdCheck.innerHTML="密码长度太短,请输入6位及以上长度的密码!";
						pwdCheck.style.color="red";
					}
				}
			}
			repwd.onblur=function(){
				if(repwd.value.trim()!=pwd.value.trim()||repwd.value.trim()==""){
					repwdCheck.innerHTML="你第二次输入的密码不正确!";
					repwdCheck.style.color="red";
				}
				else{
					repwdCheck.innerHTML="密码正确!";
					repwdCheck.style.color="green";
				}
			}
			
			oName.onblur=function(){
				var oScript=document.createElement("script");
				oScript.src="http://10.9.163.115:8081/user/CheckUserNameGet?name="+oName.value+"&callback=fnCheck";
				document.body.appendChild(oScript);
				oScript.onload=function(){
					this.parentNode.removeChild(this);
				}
			}
			function fnCheck(data){
				if(oName.value.trim()==""){
					nameCheck.innerHTML="用户名不能为空!";
					nameCheck.style.color="red";
				}
				else{
					if(data==-1){
						nameCheck2.innerHTML="用户名不存在!";
						nameCheck2.style.color="red";
					}
					else{
						nameCheck2.innerHTML="用户名正确!";
						nameCheck2.style.color="green";
					}
				}
			}
			
			register.onclick=function(){
				var oScript=document.createElement("script");
				oScript.src="http://10.9.163.115:8081/user/registerGet?username="+oName.value+"&password="+pwd.value+"&callback=fn";
				document.body.appendChild(oScript);
				oScript.onload=function(){
					this.parentNode.removeChild(this);
				}
			}
			function fn(data){
				if(data==1){
					var result=confirm("注册成功!是否转到登录页面?");
					if(result){
						window.location.href="login.html"; 
					}
					else{
						location.reload();
					}
				}
			}
		</script>
		
	</body>
</html>
