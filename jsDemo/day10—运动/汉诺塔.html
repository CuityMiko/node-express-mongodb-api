<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>汉诺塔</title>
		<style>
			*{margin: 0;padding: 0;}
			#box{width: 1050px;height: 500px;border: 2px solid salmon;position: relative;}
			#pole1,#pole2,#pole3{float: left;width: 30px;height: 400px;margin:0 160px;margin-top: 50px;}
			#pole1{background: red;}
			#pole2{background: green;}
			#pole3{background: blue;}
			#hor{width: 1050px;height: 20px;background: yellow;clear: both;}
			div{text-align: center;font-size: 16px;line-height: 20px;line-height: 30px;font-weight: bold;}
		</style>
		<script src="moveUtil.js"></script>
	</head>
	<body>
		<div id="box">
			<div id="pole1"></div>
			<div id="pole2"></div>
			<div id="pole3"></div>
			<div id="hor"></div>
		</div>
		<br /><br />
		请输入个数:<input type="text" name="" id="txt" />
		<input type="button" value="确定" id="btn" />
		请选择时间(单位:ms)<select id="sel">
			<option>400</option>
			<option>500</option>
			<option>600</option>
			<option>700</option>
			<option>800</option>
		</select>
		<input type="button" value="开始" id="btn2" /><br /><br />
		步骤:<br /><textarea id="pInfo" cols="30" rows="10" style="padding:20px 0 0 30px;"></textarea>
		
		<script>
			var box=document.getElementById("box");
			var sel=document.getElementById("sel");
			var pole1=document.getElementById("pole1");
			var pole2=document.getElementById("pole2");
			var pole3=document.getElementById("pole3");
			var txt=document.getElementById("txt");
			var btn=document.getElementById("btn");
			var btn2=document.getElementById("btn2");
			var pInfo=document.getElementById("pInfo");
			var newDiv=[];
			//存储动画
			var moveArr=[[]];
			//设置动画时间
			var speed;
			//计算步数
			var deep=0;
			var index=0;
			var timer;
			
			btn.onclick=function(){
				for(var i=0;i<txt.value;i++){
					newDiv[i]=document.createElement("div");
					newDiv[i].style.background="rgb("+Math.floor(Math.random()*255)+","+Math.floor(Math.random()*255)+","+Math.floor(Math.random()*255)+")";
					newDiv[i].style.width=((txt.value-i)*20+40)+"px";
					newDiv[i].style.height="30px";
					newDiv[i].style.position="absolute";
					newDiv[i].innerHTML=txt.value-i;
					newDiv[i].style.left=(155-(txt.value-i)*10)+"px";//175 525 875(-20)
					newDiv[i].style.top=(420-i*30)+"px";
					box.appendChild(newDiv[i]);
				}
				btn2.onclick=function(){
					speed=parseInt(sel.value);
	      			hanoi(txt.value,1,2,3);
	      			start();
				}
				
			}
			function hanoi(n,a,b,c){
	          	if(n==1){
	              		moveArr[index++]=[n,a,c];
	              		
	         	}
	         	else{
	              	hanoi(n-1,a,c,b);//前四堆
			        moveArr[index++]=[n,a,c];//第五根
			       	hanoi(n-1,b,a,c);//前四堆
	          	}
	      	}
      		function move(n,line1,line2){
      			//line1*350-175
      			var count=checkNum(line2);
      			var target1={
      				"top":150
      			}
      			var target2={
      				"left":(line2*350-195)-n*10
      			}
      			var target3={
      				"top":420-count*30
      			}
      			moveStart(newDiv[txt.value-n],target1,function(){
      				moveStart(newDiv[txt.value-n],target2,function(){
      					moveStart(newDiv[txt.value-n],target3);
      				})
      			});
      			/*newDiv[txt.value-n].style.left=((line2*350-195)-n*10)+"px";
      			newDiv[txt.value-n].style.top=(420-count*30)+"px";*/
      		}
      		
      		function start(){
      			if(moveArr.length<1){
      				return;
      			}
      			else{
      				var n=parseInt(moveArr[0][0]);
      				var line1=moveArr[0][1];
      				var line2=moveArr[0][2];
      				move(n,line1,line2);
      				pInfo.innerHTML+="步数"+(++deep)+":  Move "+n+" from "+line1+" to "+line2+"\n";
      				moveArr.shift();
      				timer=setTimeout(function(){
      					start();
      				},speed);
      			}
      			
      			
      		}
      		
      		function checkNum(n){
      			var count=0;
      			//[350*(n-1),350*n]
      			for(var i=0;i<newDiv.length;i++){
      				if(newDiv[i].offsetLeft>=350*(n-1)&&newDiv[i].offsetLeft<=350*n){
      					count++;
      				}
      			}
      			return count;
      		}
		</script>
	</body>
</html>
