<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>贪吃蛇</title>
		<style>
			#game{margin: 50px auto;position: relative;background: #000;overflow: hidden;}
			#txt{text-align: center;}
			input{font-size: 20px;color: brown;line-height: 30px;width: 50px;height: 30px;}
		</style>
		<script src="moveUtil.js"></script>
	</head>
	<body>
		
		<div id="game"></div>
		<div id="txt">
			分数:<input type="text" value="0" id="score" readonly="readonly" />
			速度:<input type="text" value="1" id="speed" readonly="readonly" />
		</div>
		
		<script>
			var score=document.getElementById("score");
			var speed=document.getElementById("speed");
			//设置游戏区域大小
			var game=document.getElementById("game");
			var gameHeight=500;
			var gameWidth=500;
			//蛇(用数组存取)
			var snakeArr=[];
			//设置蛇的大小(由很多小的div拼接,并且有1px的border)
			var snakeSize=20;
			//设置蛇的长度
			var snakeLength=4;
			//食物(随机出现,位置在规定位置,大小等于蛇的大小)
			var food;
			//蛇前进的方向
			var left=37;
			var up=38;
			var right=39;
			var down=40;
			//初始化蛇的方向
			var direct=right;
			//设置定时器
			var timer;
			
			init();
			timer=setInterval(snakeMove,(100/speed.value));
			//游戏初始化
			function init(){
				initGameArea();
				initSnake();
				initFood();
			}
			
			//创建游戏区域
			function initGameArea(){
				game.style.width=gameWidth+"px";
				game.style.height=gameHeight+"px";
			}
			
			//初始化蛇
			function initSnake(){
				for(var i=0;i<snakeLength;i++){
				 	snakeArr[i]=document.createElement("div");
				 	snakeArr[i].style.width=(snakeSize-2)+"px";
				 	snakeArr[i].style.height=(snakeSize-2)+"px";
				 	snakeArr[i].style.background="blue";
				 	snakeArr[i].style.border="1px solid pink";
				 	snakeArr[i].style.position="absolute";
				 	snakeArr[i].style.left=snakeSize*(4-i)+"px";
				 	game.appendChild(snakeArr[i]);
				 }
			}
			
			//初始化食物
			function initFood(){
				food=document.createElement("div");
				food.style.width=snakeSize+"px";
				food.style.height=snakeSize+"px";
				food.style.background="red";
				food.style.position="absolute";
				var foodLeft=Math.floor(Math.random()*gameWidth/snakeSize)*snakeSize;
				var foodTop=Math.floor(Math.random()*gameHeight/snakeSize)*snakeSize;
				//不能出现在蛇身上面
				var flag=true;
				while(flag){
					flag=false;
					for(var i=snakeArr.length-1;i>=0;i--){
						if(snakeArr[i].offsetLeft==foodLeft||snakeArr[i].offsetTop==foodTop){
							flag=true;
							foodLeft=Math.floor(Math.random()*gameWidth/snakeSize)*snakeSize;
							foodTop=Math.floor(Math.random()*gameHeight/snakeSize)*snakeSize;
						}
					}
				}
				food.style.left=foodLeft+"px";
				food.style.top=foodTop+"px";
				game.appendChild(food);
			}
			
			//蛇移动
			function snakeMove(){
				//判断是否死亡
				check();
				//判断是否吃到食物
				ifEatFood();
				//移动蛇身
//				var snakeHeadLeft=snakeArr[0].offsetLeft;
//				var snakeHeadTop=snakeArr[0].offsetTop;
				for(var i=snakeArr.length-1;i>0;i--){
					snakeArr[i].style.left=snakeArr[i-1].offsetLeft+"px";
					snakeArr[i].style.top=snakeArr[i-1].offsetTop+"px";
				}
				//根据方向移动蛇头
				switch(direct){
					case left:
						if(snakeArr[0].offsetLeft<=0){
							snakeArr[0].style.left=gameWidth-snakeSize+"px";
						}else{
							snakeArr[0].style.left=snakeArr[0].offsetLeft-snakeSize+"px";
						}
						break;
					case right:
						if(snakeArr[0].offsetLeft>=gameWidth-snakeSize){
							snakeArr[0].style.left=0;
						}else{
							snakeArr[0].style.left=snakeArr[0].offsetLeft+snakeSize+"px";
						}
						break;
					case up:
						if(snakeArr[0].offsetTop<=0){
							snakeArr[0].style.top=gameHeight-snakeSize+"px";
						}else{
							snakeArr[0].style.top=snakeArr[0].offsetTop-snakeSize+"px";
						}
						break;
					case down:
						if(snakeArr[0].offsetTop>=gameHeight-snakeSize){
							snakeArr[0].style.top=0;
						}else{
							snakeArr[0].style.top=snakeArr[0].offsetTop+snakeSize+"px";
						}
						break;
				}
			}
			
			function ifEatFood(){
				if(snakeArr[0].offsetLeft==food.offsetLeft&&snakeArr[0].offsetTop==food.offsetTop){
					score.value++;
					if(score.value%10==0){
						clearInterval(timer);
						speed.value++;
						if(speed.value>5){
							speed=5;
						}
						timer=setInterval(snakeMove,(100-10*speed.value));
					}
					game.removeChild(food);
					initFood();
					var divNew=document.createElement("div");
					divNew.style.width=(snakeSize-2)+"px";
				 	divNew.style.height=(snakeSize-2)+"px";
				 	divNew.style.background="blue";
				 	divNew.style.border="1px solid pink";
				 	divNew.style.position="absolute";
				 	divNew.style.top=snakeArr[snakeArr.length-1].offsetTop+"px";
				 	divNew.style.left=snakeArr[snakeArr.length-1].offsetLeft+"px";
				 	game.appendChild(divNew);
				 	snakeArr.push(divNew);
				}
			}
			
			//判断蛇是否已经死了（1.蛇头和蛇身接触;2.蛇头碰到了边缘）
			function check(){
				//1.蛇头和蛇身接触
				for(var i=1;i<snakeArr.length;i++){
					if(snakeArr[0].offsetLeft==snakeArr[i].offsetLeft&&snakeArr[0].offsetTop==snakeArr[i].offsetTop){
						clearInterval(timer);
						var result=window.confirm("您已经输了,是否重新游戏?");
						if(result){
							location.reload();
						}
					}
				}
				
			}
			
			//按键触发方向改变
			document.onkeydown=function(e){
				var e=e||window.event;
				//判断按键与方向
				if(e.keyCode==left&&direct!=right){
					direct=left;
				}
				else if(e.keyCode==right&&direct!=left){
					direct=right;
				}
				else if(e.keyCode==up&&direct!=down){
					direct=up;
				}
				else if(e.keyCode==down&&direct!=up){
					direct=down;
				}
			}
			
		</script>
	</body>
</html>
