<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>飞机大战</title>
    <style>
        *{margin: 0;padding: 0;}
        #btstart{ width: 150px; height: 40px;background:burlywood;position: absolute; top:450px; left:80px;}
        #maindiv{ width: 320px;height:568px; background: url(img/开始背景.png) no-repeat;position:relative;overflow: hidden; margin: 0 0 0 500px;}
   		p{position: absolute;z-index: 100;}
   		#score{top: 0px;left: 40px;}
    </style>
</head>
<body>
    <div id="maindiv">
    	<p id="jifen">分数:</p><p id="score">0</p>
    	<input id="btstart" type="button" value="开始游戏"/>
    </div>

<script>
    //开始按钮
    var oBtStart=document.getElementById("btstart");
    //游戏界面
    var oMainDiv=document.getElementById("maindiv");
    //积分
    var oScore=document.getElementById("score");
    //游戏总定时器
    var timer;   
    //地方飞机定时器
    var timerEnemy;   
    //飞机摧毁的定时器
    //var timeBoom;
    //游戏界面的背景定位坐标。
    var MainDivBKPositionY=0;
    //记录我的飞机
    var myPlan;	
	//记录敌方飞机
	var arrEnemyPlan=[];	
	//记录敌方死亡飞机
	var arrDeadPlan=[];
    //存放子弹的数组。
    var arrBullet=[];
    //子弹的移动速度
    var speedBullet=40;
    //子弹的数量
    var bulletSize=1;
    //子弹持续时间
    var bulletStayTime=0;
    //子弹发射的频率
    var bulletRate=0;
	//记录敌方飞机的大小
	var planSize=0;	
	//记录敌方飞机的移动速度
	var speedEnemyPlan=2;
    //开始按钮的点击事件
    oBtStart.onclick=function (){
        //进入主界面。  隐藏开始界面，显示主界面。
        oMainDiv.removeChild(oBtStart);
      	oMainDiv.style.background="url(img/background_1.png)";

        startGame();
    }
    //开始游戏
    function startGame(){
        clearInterval(timer);
        clearInterval(timerEnemy);
    	//创建我的飞机
        myPlan=createMyPlan();
        moveMyPlan();
        timer=setInterval(function(){
            //1.背景动起来
            oMainDiv.style.backgroundPositionY=MainDivBKPositionY+"px";
            MainDivBKPositionY+=1;
           	//2. 创建子弹。
            //每个30毫秒就创建一个子弹。
            bulletRate++;
            if(bulletRate%5==0)
            	createBullet();
            moveBullet();
        	moveEnemyPlan();
        },30);
        timerEnemy=setInterval(function(){
        	createEnemyPlan();
        },500);
    }
    //创建我的飞机
    function createMyPlan(){
        var oMyPlan=document.createElement("div");
        oMyPlan.style.width="66px";
        oMyPlan.style.height="80px";
        oMyPlan.style.position="absolute";
        oMyPlan.style.background="url(img/我的飞机.gif) no-repeat";
        oMyPlan.style.top="480px";
        oMyPlan.style.left="127px";
        oMyPlan.style.zIndex=10;
        oMainDiv.appendChild(oMyPlan);
        return oMyPlan;
    }
    //移动我的飞机
    function moveMyPlan(){
        document.onmousemove=function(event){
            event=event||window.event;
            var mLeft=event.clientX-500-33;
            var mTop=event.clientY-41;
            //边界
            if(mTop<=0){
                mTop=0;
            }
            if(mTop>=568-82){
                mTop=486;
            }
            if(mLeft<=-33){
                mLeft=-33;
            }
            if(mLeft>=320-33){
                mLeft=287;
            }

            myPlan.style.top=mTop+"px";
            myPlan.style.left=mLeft+"px";
        }
    }
    //创建子弹
    function createBullet(){
    	for(var i=0;i<bulletSize;i++){
	        var bullet=document.createElement("div");
	        bullet.style.width="6px";
	        bullet.style.height="14px";
	        bullet.style.background="url(img/bullet1.png) no-repeat";
	        bullet.style.position="absolute";
	        bullet.style.top=myPlan.offsetTop-14+speedBullet+"px";//我的飞机的top，
	        if(bulletSize==1){
	        	bullet.style.left=myPlan.offsetLeft+33-3+"px";
	        }
	        else if(bulletSize==3){
	        	bullet.style.left=myPlan.offsetLeft+13+20*i-3+"px";
	        }
	        //我的飞机的left +我的飞机的宽度的一半，在减去子弹的宽度的一半
	        oMainDiv.appendChild(bullet);
	        arrBullet.push(bullet);
    	}
    }
    //移动子弹  所有的子弹 移动一步。
    //然后再总定时器中 调用。
    function moveBullet(){
    	if(bulletSize==3){
    		bulletStayTime++;
    		if(bulletStayTime==150){
    			bulletStayTime=0;
    			bulletSize=1;
    		}
    	}
        //操作子弹的top ， 变小。向上跑。。
        //子弹在哪里？arrBullet
        for(var i=0;i<arrBullet.length;i++){
            arrBullet[i].style.top=arrBullet[i].offsetTop-speedBullet+"px";
        }
        //如果子弹已经出去了， 删除。
        //top =-14；
        for(var j=0;j<arrBullet.length;j++){
            if(arrBullet[j].offsetTop<=-14){
                //删除
                oMainDiv.removeChild(arrBullet[j]);
                arrBullet.splice(j,1);
            }
        }
    }    
    //判断敌方飞机的种类
    function checkEnemyPlanSize(temp){
    	if(temp==20){
    		return 3;
    	}
    	else if(temp%10==0){
    		return 2;
    	}
    	else{
    		return 1;
    	}
    }    
    //创建敌方飞机
    function createEnemyPlan(){
        var enemyPlan=document.createElement("div");
    	var result=checkEnemyPlanSize(planSize);
        switch(result){
        	case 1:
        		enemyPlan.style.width="34px";
      		  	enemyPlan.style.height="24px";
        		enemyPlan.style.background="url(img/enemy1_fly_1.png) no-repeat";
        		enemyPlan.boomBg="url(img/enemy1_fly_1.gif) no-repeat";
        		enemyPlan.size="small";
        		enemyPlan.score=1000;
        		enemyPlan.hp=1;
        		break;
        	case 2:0        
        		enemyPlan.style.width="46px";
      		  	enemyPlan.style.height="60px";
        		enemyPlan.style.background="url(img/enemy2_fly_1.png) no-repeat";
        		enemyPlan.boomBg="url(img/enemy2_fly_1.gif) no-repeat";
        		enemyPlan.aidaBg="url(img/中飞机挨打.png) no-repeat";
        		enemyPlan.hp=5;
        		enemyPlan.score=2000;
        		enemyPlan.size="middle";
        		break;
        	case 3:
        		enemyPlan.style.width="110px";
      		  	enemyPlan.style.height="164px";
        		enemyPlan.style.background="url(img/enemy3_fly_1.png) no-repeat";
        		enemyPlan.boomBg="url(img/enemy3_fly_1.gif) no-repeat";
        		enemyPlan.aidaBg="url(img/大飞机挨打.png) no-repeat";
        		enemyPlan.hp=10;
        		enemyPlan.score=5000;
        		enemyPlan.size="big";
        		break;
        }
        enemyPlan.food=false;
        enemyPlan.deadTime=0;
        enemyPlan.style.position="absolute";
        enemyPlan.style.top="-164px";//-164px
        enemyPlan.style.left=Math.floor(Math.random()*210)+"px";
        enemyPlan.isDead=false;
        oMainDiv.appendChild(enemyPlan);
        arrEnemyPlan.push(enemyPlan);
        //对planSize进行操作
        if(planSize==20){
        	planSize=0;
        }
        else{
        	planSize++;
        }
    }    
    function moveEnemyPlan(){
    	//clearTimeout(timeOver);
    	//敌方飞机的Top变化
        for(var i=0;i<arrEnemyPlan.length;i++){
        	if(!arrEnemyPlan[i].isDead)
           		arrEnemyPlan[i].style.top=arrEnemyPlan[i].offsetTop+speedEnemyPlan+"px";
        }
        //判断时候出界
        for(var j=0;j<arrEnemyPlan.length;j++){
            if(arrEnemyPlan[j].offsetTop>=568){
                oMainDiv.removeChild(arrEnemyPlan[j]);
                arrEnemyPlan.splice(j,1);
            }
        }
        checkWeBoom();
        checkTheyBoom();
    }  
    function checkWeBoom(){
    	//判断是否相撞
        for(var j=0;j<arrEnemyPlan.length;j++){
            if(	
            	arrEnemyPlan[j].offsetTop+arrEnemyPlan[j].offsetHeight>=myPlan.offsetTop&&
            	arrEnemyPlan[j].offsetTop-myPlan.offsetHeight<=myPlan.offsetTop&&
            	arrEnemyPlan[j].offsetLeft+arrEnemyPlan[j].offsetWidth>=myPlan.offsetLeft&&
            	arrEnemyPlan[j].offsetLeft-myPlan.offsetWidth<=myPlan.offsetLeft
            ){
            	if(arrEnemyPlan[j].food){
            		oMainDiv.removeChild(arrEnemyPlan[j]);
            		bulletSize=3;
            	}
            	else{
	            	if(!arrEnemyPlan[j].isDead){
	            		//我方飞机爆炸
		            	myPlan.style.background="url(img/本方飞机爆炸.gif) no-repeat";
		            	//让所有飞机停止
		        		clearInterval(timer);
		        		clearInterval(timerEnemy);
		        		document.onmousemove=null;
		            	//重新开始
		            	var finallyScore=document.createElement("p");
		            	finallyScore.innerHTML="你的最终分数是:"+oScore.innerHTML;
		            	finallyScore.style.top="400px";
		            	finallyScore.style.left="100px";
		            	oMainDiv.appendChild(finallyScore);
		            	var newButton=document.createElement("input");
		            	newButton.id="btstart";
		            	newButton.type="button";
		            	newButton.value="重新开始";
		            	newButton.style.zIndex=20;
		            	oMainDiv.appendChild(newButton);
		            	newButton.onclick=function(){
		            		location.reload();
		            		startGame();
		            	}
	            	}
            	}
            }
        }
    }
    function checkTheyBoom(){
	    for(var j=0;j<arrEnemyPlan.length;j++){
	        for(var k=0;k<arrBullet.length;k++){
		    	if(arrEnemyPlan[j].isDead){
				    arrEnemyPlan[j].deadTime++;
			        if(arrEnemyPlan[j].deadTime==100&&!arrEnemyPlan[j].food){
			   			if(arrEnemyPlan[j].size=="big"){
					        arrEnemyPlan[j].style.width="5px";
					        arrEnemyPlan[j].style.height="5px";
					        arrEnemyPlan[j].style.background="red";
					        arrEnemyPlan[j].style.top=arrEnemyPlan[j].offsetTop+82+"px";
					        arrEnemyPlan[j].style.left=arrEnemyPlan[j].offsetLeft+55+"px";
					        arrEnemyPlan[j].food=true;
					    }
			   			else
							oMainDiv.removeChild(arrEnemyPlan[j]);
						//var deadPlan=arrEnemyPlan.splice(j,1);
						//arrDeadPlan.push(deadPlan);
						j--;
					}
		    	}
		    	else{
			        if(	
				        arrBullet[k].offsetTop+arrBullet[k].offsetHeight>=arrEnemyPlan[j].offsetTop&&
				        arrBullet[k].offsetTop-arrEnemyPlan[j].offsetHeight<=arrEnemyPlan[j].offsetTop&&
				        arrBullet[k].offsetLeft+arrBullet[k].offsetWidth>=arrEnemyPlan[j].offsetLeft&&
				        arrBullet[k].offsetLeft-arrEnemyPlan[j].offsetWidth<=arrEnemyPlan[j].offsetLeft
				   	){
				        oMainDiv.removeChild(arrBullet[k]);
					    arrBullet.splice(k,1);
				        arrEnemyPlan[j].hp--;
				        arrEnemyPlan[j].style.background=arrEnemyPlan[j].aidaBg;
					    if(arrEnemyPlan[j].hp==0){
					        arrEnemyPlan[j].isDead=true;
					        oScore.innerHTML=parseInt(oScore.innerHTML)+arrEnemyPlan[j].score;
					        if(parseInt(oScore.innerHTML)>=50000){
					            speedEnemyPlan=3;
					            if(parseInt(oScore.innerHTML)>=100000){
					            	speedEnemyPlan=5;
					            	if(parseInt(oScore.innerHTML)>=200000){
					            		speedEnemyPlan=7;
					            		if(parseInt(oScore.innerHTML)>=4000000){
					            			speedEnemyPlan=10;
					            		}
					            	}
					            }
					        } 
					        arrEnemyPlan[j].style.background=arrEnemyPlan[j].boomBg;
					    }  
					}
	        	}
		    }
	    }
    }
</script>
</body>
</html>